<script>
  document.addEventListener('DOMContentLoaded', async function () {
    const calendarEl = document.getElementById('calendar');

    async function loadTrips(){
      const res = await fetch('data/trips.json', { cache: 'no-store' });
      if(!res.ok) throw new Error('Failed to load trips.json');
      const trips = await res.json();
      // FullCalendar expects {title,start,end,url}
      return trips.map(t => ({
        title: `${t.title} • ${t.location}`,
        start: t.start,
        end: t.end,
        url: t.link || null,
        extendedProps: t
      }));
    }

    const events = await loadTrips();

    const cal = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      height: 'auto',
      events,
      eventClick: function(info){
        info.jsEvent.preventDefault();
        const t = info.event.extendedProps;
        const msg =
          `${t.title}\n` +
          `Location: ${t.location}\n` +
          `Level: ${t.level}\n` +
          `Dates: ${info.event.startStr} → ${info.event.endStr || info.event.startStr}\n` +
          (t.note ? `\n${t.note}` : '');
        alert(msg);
        if (t.link) window.open(t.link, '_blank');
      }
    });

    cal.render();
  });
</script>
